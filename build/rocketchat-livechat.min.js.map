{"version":3,"sources":["webpack:///webpack/bootstrap","webpack:///./src/widget.js","webpack:///../src/index.ts"],"names":["installedModules","__webpack_require__","moduleId","exports","module","i","l","modules","call","m","c","d","name","getter","o","Object","defineProperty","enumerable","get","r","Symbol","toStringTag","value","t","mode","__esModule","ns","create","key","bind","n","object","property","prototype","hasOwnProperty","p","s","log","window","RocketChat","_","widget","iframe","bodyStyle","scrollPosition","widget_height","all","config","hookQueue","ready","smallScreen","validCallbacks","callbacks","Map","on","type","handler","handlers","push","set","off","splice","indexOf","emit","evt","slice","map","registerCallback","eventName","fn","emitCallback","data","callHook","action","params","src","args","contentWindow","postMessage","updateWidgetStyle","isOpened","document","documentElement","scrollTop","body","style","cssText","left","height","width","WIDGET_MARGIN","openWidget","dataset","state","focus","closeWidget","api","popup","length","forEach","hookParams","apply","this","minimizeWindow","restoreWindow","closed","close","openPopout","open","url","lastIndexOf","resizeWidget","removeWidget","removeChild","callback","showWidget","display","hideWidget","showPrint","hidePrint","resetDocumentStyle","setFullScreenDocumentMobile","pageVisited","change","location","JSON","parse","stringify","title","setCustomField","overwrite","setTheme","theme","setDepartment","department","setGuestToken","token","setGuestName","setGuestEmail","email","registerGuest","guest","setAgent","agent","setLanguage","language","currentPage","href","init","createElement","className","position","maxHeight","bottom","right","zIndex","container","id","allowTransparency","parentURL","border","backgroundColor","appendChild","handleMediaQueryTest","matches","mediaQueryList","matchMedia","addListener","createWidget","addEventListener","msg","undefined","concat","setInterval","initRocket","console","warn","queue","livechat","initialize","method","Array","isArray","clearDepartment","maximizeWidget","minimizeWidget","onChatMaximized","onChatMinimized","onChatStarted","onChatEnded","onPrechatFormSubmit","onOfflineFormSubmit","onWidgetShown","onWidgetHidden","onAssignAgent","onAgentStatusChange","onQueuePositionChange","onServiceOffline"],"mappings":"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","file":"rocketchat-livechat.min.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"livechat/\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 0);\n","import mitt from 'mitt';\n\nconst log = process.env.NODE_ENV === 'development'\n\t? (...args) => window.console.log('%cwidget%c', 'color: red', 'color: initial', ...args)\n\t: () => {};\n\n\nconst WIDGET_OPEN_WIDTH = 365;\nconst WIDGET_OPEN_HEIGHT = 525;\nconst WIDGET_MINIMIZED_WIDTH = 54;\nconst WIDGET_MINIMIZED_HEIGHT = 54;\nconst WIDGET_MARGIN = 16;\nconst FULLSCREEN_DOCUMENT_CONFIG = 'overflow: hidden; height: 100%; width: 100%;';\n\n\nwindow.RocketChat = window.RocketChat || { _: [] };\nconst config = {};\nlet widget;\nlet iframe;\nlet hookQueue = [];\nlet ready = false;\nlet smallScreen = false;\nlet bodyStyle;\nlet scrollPosition;\nlet widget_height;\n\nexport const validCallbacks = [\n\t'chat-maximized',\n\t'chat-minimized',\n\t'chat-started',\n\t'chat-ended',\n\t'pre-chat-form-submit',\n\t'offline-form-submit',\n\t'show-widget',\n\t'hide-widget',\n\t'show-print',\n\t'hide-print',\n\t'assign-agent',\n\t'agent-status-change',\n\t'queue-position-change',\n\t'no-agent-online',\n];\n\nconst callbacks = mitt();\n\nfunction registerCallback(eventName, fn) {\n\tif (validCallbacks.indexOf(eventName) === -1) {\n\t\treturn false;\n\t}\n\n\treturn callbacks.on(eventName, fn);\n}\n\nfunction emitCallback(eventName, data) {\n\tif (typeof data !== 'undefined') {\n\t\tcallbacks.emit(eventName, data);\n\t} else {\n\t\tcallbacks.emit(eventName);\n\t}\n}\n\n// hooks\nfunction callHook(action, params) {\n\tif (!ready) {\n\t\treturn hookQueue.push([action, params]);\n\t}\n\tconst data = {\n\t\tsrc: 'rocketchat',\n\t\tfn: action,\n\t\targs: params,\n\t};\n\tiframe.contentWindow.postMessage(data, '*');\n}\n\nconst updateWidgetStyle = (isOpened) => {\n\tif (smallScreen && isOpened) {\n\t\tscrollPosition = document.documentElement.scrollTop;\n\t\tbodyStyle = document.body.style.cssText;\n\t\tdocument.body.style.cssText += FULLSCREEN_DOCUMENT_CONFIG;\n\t} else {\n\t\tdocument.body.style.cssText = bodyStyle;\n\t\tif (smallScreen) {\n\t\t\tdocument.documentElement.scrollTop = scrollPosition;\n\t\t}\n\t}\n\n\tif (isOpened) {\n\t\twidget.style.left = smallScreen ? '0' : 'auto';\n\n\t\t/**\n\t\t * If we use widget.style.height = smallScreen ? '100vh' : ...\n\t\t * In above case some browser's viewport height is not rendered correctly\n\t\t * so, as 100vh will resolve to 100% of the current viewport height,\n\t\t * so fixed it to 100% avoiding problem for some browsers. Similar resolution\n\t\t * for widget.style.width\n\t\t */\n\n\t\twidget.style.height = smallScreen ? '100%' : `${ WIDGET_MARGIN + widget_height + WIDGET_MARGIN + WIDGET_MINIMIZED_HEIGHT }px`;\n\t\twidget.style.width = smallScreen ? '100%' : `${ WIDGET_MARGIN + WIDGET_OPEN_WIDTH + WIDGET_MARGIN }px`;\n\t} else {\n\t\twidget.style.left = 'auto';\n\t\twidget.style.width = `${ WIDGET_MARGIN + WIDGET_MINIMIZED_WIDTH + WIDGET_MARGIN }px`;\n\t\twidget.style.height = `${ WIDGET_MARGIN + WIDGET_MINIMIZED_HEIGHT + WIDGET_MARGIN }px`;\n\t}\n};\n\nconst createWidget = (url) => {\n\twidget = document.createElement('div');\n\twidget.className = 'rocketchat-widget';\n\twidget.style.position = 'fixed';\n\twidget.style.width = `${ WIDGET_MARGIN + WIDGET_MINIMIZED_WIDTH + WIDGET_MARGIN }px`;\n\twidget.style.height = `${ WIDGET_MARGIN + WIDGET_MINIMIZED_HEIGHT + WIDGET_MARGIN }px`;\n\twidget.style.maxHeight = '100vh';\n\twidget.style.bottom = '0';\n\twidget.style.right = '0';\n\twidget.style.zIndex = '12345';\n\twidget.dataset.state = 'closed';\n\n\tconst container = document.createElement('div');\n\tcontainer.className = 'rocketchat-container';\n\tcontainer.style.width = '100%';\n\tcontainer.style.height = '100%';\n\n\tiframe = document.createElement('iframe');\n\tiframe.id = 'rocketchat-iframe';\n\tiframe.allowTransparency = 'true';\n\tiframe.src = url;\n\tiframe.name = window.RocketChat.parentURL;\n\tiframe.style.width = '100%';\n\tiframe.style.height = '100%';\n\tiframe.style.border = 'none';\n\tiframe.style.backgroundColor = 'transparent';\n\n\tcontainer.appendChild(iframe);\n\twidget.appendChild(container);\n\tdocument.body.appendChild(widget);\n\n\tconst handleMediaQueryTest = ({ matches }) => {\n\t\tif (!widget) {\n\t\t\treturn;\n\t\t}\n\n\t\tsmallScreen = matches;\n\t\tupdateWidgetStyle(widget.dataset.state === 'opened');\n\t\tcallHook('setExpanded', smallScreen);\n\t};\n\n\tconst mediaQueryList = window.matchMedia('screen and (max-device-width: 480px)');\n\tmediaQueryList.addListener(handleMediaQueryTest);\n\thandleMediaQueryTest(mediaQueryList);\n};\n\nconst openWidget = () => {\n\tif (widget.dataset.state === 'opened') {\n\t\treturn;\n\t}\n\n\twidget_height = WIDGET_OPEN_HEIGHT;\n\tupdateWidgetStyle(true);\n\twidget.dataset.state = 'opened';\n\tiframe.focus();\n\temitCallback('chat-maximized');\n};\n\nconst resizeWidget = (height) => {\n\twidget_height = height;\n\tupdateWidgetStyle(true);\n\twidget.dataset.state = 'triggered';\n};\n\nfunction closeWidget() {\n\tif (widget.dataset.state === 'closed') {\n\t\treturn;\n\t}\n\n\tupdateWidgetStyle(false);\n\twidget.dataset.state = 'closed';\n\temitCallback('chat-minimized');\n}\n\nconst api = {\n\tpopup: null,\n\n\tready() {\n\t\tready = true;\n\t\tif (hookQueue.length > 0) {\n\t\t\thookQueue.forEach(function(hookParams) {\n\t\t\t\tcallHook.apply(this, hookParams);\n\t\t\t});\n\t\t\thookQueue = [];\n\t\t}\n\t},\n\n\tminimizeWindow() {\n\t\tcloseWidget();\n\t},\n\n\trestoreWindow() {\n\t\tif (api.popup && api.popup.closed !== true) {\n\t\t\tapi.popup.close();\n\t\t\tapi.popup = null;\n\t\t}\n\t\topenWidget();\n\t},\n\n\topenPopout() {\n\t\tcloseWidget();\n\t\tapi.popup = window.open(`${ config.url }${ config.url.lastIndexOf('?') > -1 ? '&' : '?' }mode=popout`,\n\t\t\t'livechat-popout', `width=${ WIDGET_OPEN_WIDTH }, height=${ widget_height }, toolbars=no`);\n\t\tapi.popup.focus();\n\t},\n\n\topenWidget() {\n\t\topenWidget();\n\t},\n\n\tresizeWidget(height) {\n\t\tresizeWidget(height);\n\t},\n\n\tremoveWidget() {\n\t\tdocument.body.removeChild(widget);\n\t},\n\n\tcallback(eventName, data) {\n\t\temitCallback(eventName, data);\n\t},\n\n\tshowWidget() {\n\t\tiframe.style.display = 'initial';\n\t\temitCallback('show-widget');\n\t},\n\n\thideWidget() {\n\t\tiframe.style.display = 'none';\n\t\temitCallback('hide-widget');\n\t},\n\n\tshowPrint() {\n\t\temitCallback('show-print');\n\t},\n\n\thidePrint() {\n\t\temitCallback('hide-print');\n\t},\n\n\tresetDocumentStyle() {\n\t\tdocument.body.style.cssText = bodyStyle;\n\t},\n\n\tsetFullScreenDocumentMobile() {\n\t\tdocument.body.style.cssText += smallScreen && FULLSCREEN_DOCUMENT_CONFIG;\n\t},\n};\n\nfunction pageVisited(change) {\n\tcallHook('pageVisited', {\n\t\tchange,\n\t\tlocation: JSON.parse(JSON.stringify(document.location)),\n\t\ttitle: document.title,\n\t});\n}\n\nfunction setCustomField(key, value, overwrite) {\n\tif (typeof overwrite === 'undefined') {\n\t\toverwrite = true;\n\t}\n\tcallHook('setCustomField', [key, value, overwrite]);\n}\n\nfunction setTheme(theme) {\n\tcallHook('setTheme', theme);\n}\n\nfunction setDepartment(department) {\n\tcallHook('setDepartment', department);\n}\n\nfunction setGuestToken(token) {\n\tcallHook('setGuestToken', token);\n}\n\nfunction setGuestName(name) {\n\tcallHook('setGuestName', name);\n}\n\nfunction setGuestEmail(email) {\n\tcallHook('setGuestEmail', email);\n}\n\nfunction registerGuest(guest) {\n\tcallHook('registerGuest', guest);\n}\n\nfunction clearDepartment() {\n\tcallHook('clearDepartment');\n}\n\nfunction setAgent(agent) {\n\tcallHook('setAgent', agent);\n}\n\nfunction setLanguage(language) {\n\tcallHook('setLanguage', language);\n}\n\nfunction showWidget() {\n\tcallHook('showWidget');\n}\n\nfunction hideWidget() {\n\tcallHook('hideWidget');\n}\n\nfunction showPrint() {\n\tcallHook('showPrint');\n}\n\nfunction hidePrint() {\n\tcallHook('hidePrint');\n}\n\nfunction maximizeWidget() {\n\tcallHook('maximizeWidget');\n}\n\nfunction minimizeWidget() {\n\tcallHook('minimizeWidget');\n}\n\nfunction initialize(params) {\n\tfor (const method in params) {\n\t\tif (!params.hasOwnProperty(method)) {\n\t\t\tcontinue;\n\t\t}\n\n\t\tswitch (method) {\n\t\t\tcase 'customField':\n\t\t\t\tconst { key, value, overwrite } = params[method];\n\t\t\t\tsetCustomField(key, value, overwrite);\n\t\t\t\tcontinue;\n\t\t\tcase 'setCustomFields':\n\t\t\t\tif (!Array.isArray(params[method])) {\n\t\t\t\t\tconsole.log('Error: Invalid parameters. Value must be an array of objects');\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\t\t\t\tparams[method].forEach((data) => {\n\t\t\t\t\tconst { key, value, overwrite } = data;\n\t\t\t\t\tsetCustomField(key, value, overwrite);\n\t\t\t\t});\n\t\t\t\tcontinue;\n\t\t\tcase 'theme':\n\t\t\t\tsetTheme(params[method]);\n\t\t\t\tcontinue;\n\t\t\tcase 'department':\n\t\t\t\tsetDepartment(params[method]);\n\t\t\t\tcontinue;\n\t\t\tcase 'guestToken':\n\t\t\t\tsetGuestToken(params[method]);\n\t\t\t\tcontinue;\n\t\t\tcase 'guestName':\n\t\t\t\tsetGuestName(params[method]);\n\t\t\t\tcontinue;\n\t\t\tcase 'guestEmail':\n\t\t\t\tsetGuestEmail(params[method]);\n\t\t\t\tcontinue;\n\t\t\tcase 'registerGuest':\n\t\t\t\tregisterGuest(params[method]);\n\t\t\t\tcontinue;\n\t\t\tcase 'language':\n\t\t\t\tsetLanguage(params[method]);\n\t\t\t\tcontinue;\n\t\t\tcase 'agent':\n\t\t\t\tsetAgent(params[method]);\n\t\t\t\tcontinue;\n\t\t\tdefault:\n\t\t\t\tcontinue;\n\t\t}\n\t}\n}\n\nconst currentPage = {\n\thref: null,\n\ttitle: null,\n};\n\nconst attachMessageListener = () => {\n\twindow.addEventListener('message', (msg) => {\n\t\tif (typeof msg.data === 'object' && msg.data.src !== undefined && msg.data.src === 'rocketchat') {\n\t\t\tif (api[msg.data.fn] !== undefined && typeof api[msg.data.fn] === 'function') {\n\t\t\t\tconst args = [].concat(msg.data.args || []);\n\t\t\t\tlog(`api.${ msg.data.fn }`, ...args);\n\t\t\t\tapi[msg.data.fn].apply(null, args);\n\t\t\t}\n\t\t}\n\t}, false);\n};\n\nconst trackNavigation = () => {\n\tsetInterval(() => {\n\t\tif (document.location.href !== currentPage.href) {\n\t\t\tpageVisited('url');\n\t\t\tcurrentPage.href = document.location.href;\n\t\t}\n\n\t\tif (document.title !== currentPage.title) {\n\t\t\tpageVisited('title');\n\t\t\tcurrentPage.title = document.title;\n\t\t}\n\t}, 800);\n};\n\nconst init = (url) => {\n\tif (!url) {\n\t\treturn;\n\t}\n\n\tconfig.url = url;\n\n\tcreateWidget(url);\n\tattachMessageListener();\n\ttrackNavigation();\n};\n\nif (typeof window.initRocket !== 'undefined') {\n\tconsole.warn('initRocket is now deprecated. Please update the livechat code.');\n\tinit(window.initRocket[0]);\n}\n\nif (typeof window.RocketChat.url !== 'undefined') {\n\tinit(window.RocketChat.url);\n}\n\nconst queue = window.RocketChat._;\n\nwindow.RocketChat._.push = function(c) {\n\tc.call(window.RocketChat.livechat);\n};\nwindow.RocketChat = window.RocketChat._.push;\n\n// exports\nwindow.RocketChat.livechat = {\n\t// methods\n\tpageVisited,\n\tsetCustomField,\n\tinitialize,\n\tsetTheme,\n\tsetDepartment,\n\tclearDepartment,\n\tsetGuestToken,\n\tsetGuestName,\n\tsetGuestEmail,\n\tsetAgent,\n\tregisterGuest,\n\tsetLanguage,\n\tshowWidget,\n\thideWidget,\n\tshowPrint,\n\thidePrint,\n\tmaximizeWidget,\n\tminimizeWidget,\n\n\t// callbacks\n\tonChatMaximized(fn) { registerCallback('chat-maximized', fn); },\n\tonChatMinimized(fn) { registerCallback('chat-minimized', fn); },\n\tonChatStarted(fn) { registerCallback('chat-started', fn); },\n\tonChatEnded(fn) { registerCallback('chat-ended', fn); },\n\tonPrechatFormSubmit(fn) { registerCallback('pre-chat-form-submit', fn); },\n\tonOfflineFormSubmit(fn) { registerCallback('offline-form-submit', fn); },\n\tonWidgetShown(fn) { registerCallback('show-widget', fn); },\n\tonWidgetHidden(fn) { registerCallback('hide-widget', fn); },\n\tonAssignAgent(fn) { registerCallback('assign-agent', fn); },\n\tonAgentStatusChange(fn) { registerCallback('agent-status-change', fn); },\n\tonQueuePositionChange(fn) { registerCallback('queue-position-change', fn); },\n\tonServiceOffline(fn) { registerCallback('no-agent-online', fn); },\n};\n\n// proccess queue\nqueue.forEach((c) => {\n\tc.call(window.RocketChat.livechat);\n});\n","export type EventType = string | symbol;\n\n// An event handler can take an optional event argument\n// and should not return a value\nexport type Handler<T = any> = (event?: T) => void;\nexport type WildcardHandler = (type: EventType, event?: any) => void;\n\n// An array of all currently registered event handlers for a type\nexport type EventHandlerList = Array<Handler>;\nexport type WildCardEventHandlerList = Array<WildcardHandler>;\n\n// A map of event types and their corresponding event handlers.\nexport type EventHandlerMap = Map<EventType, EventHandlerList | WildCardEventHandlerList>;\n\nexport interface Emitter {\n\tall: EventHandlerMap;\n\n\ton<T = any>(type: EventType, handler: Handler<T>): void;\n\ton(type: '*', handler: WildcardHandler): void;\n\n\toff<T = any>(type: EventType, handler: Handler<T>): void;\n\toff(type: '*', handler: WildcardHandler): void;\n\n\temit<T = any>(type: EventType, event?: T): void;\n\temit(type: '*', event?: any): void;\n}\n\n/**\n * Mitt: Tiny (~200b) functional event emitter / pubsub.\n * @name mitt\n * @returns {Mitt}\n */\nexport default function mitt(all?: EventHandlerMap): Emitter {\n\tall = all || new Map();\n\n\treturn {\n\n\t\t/**\n\t\t * A Map of event names to registered handler functions.\n\t\t */\n\t\tall,\n\n\t\t/**\n\t\t * Register an event handler for the given type.\n\t\t * @param {string|symbol} type Type of event to listen for, or `\"*\"` for all events\n\t\t * @param {Function} handler Function to call in response to given event\n\t\t * @memberOf mitt\n\t\t */\n\t\ton<T = any>(type: EventType, handler: Handler<T>) {\n\t\t\tconst handlers = all.get(type);\n\t\t\tconst added = handlers && handlers.push(handler);\n\t\t\tif (!added) {\n\t\t\t\tall.set(type, [handler]);\n\t\t\t}\n\t\t},\n\n\t\t/**\n\t\t * Remove an event handler for the given type.\n\t\t * @param {string|symbol} type Type of event to unregister `handler` from, or `\"*\"`\n\t\t * @param {Function} handler Handler function to remove\n\t\t * @memberOf mitt\n\t\t */\n\t\toff<T = any>(type: EventType, handler: Handler<T>) {\n\t\t\tconst handlers = all.get(type);\n\t\t\tif (handlers) {\n\t\t\t\thandlers.splice(handlers.indexOf(handler) >>> 0, 1);\n\t\t\t}\n\t\t},\n\n\t\t/**\n\t\t * Invoke all handlers for the given type.\n\t\t * If present, `\"*\"` handlers are invoked after type-matched handlers.\n\t\t *\n\t\t * Note: Manually firing \"*\" handlers is not supported.\n\t\t *\n\t\t * @param {string|symbol} type The event type to invoke\n\t\t * @param {Any} [evt] Any value (object is recommended and powerful), passed to each handler\n\t\t * @memberOf mitt\n\t\t */\n\t\temit<T = any>(type: EventType, evt: T) {\n\t\t\t((all.get(type) || []) as EventHandlerList).slice().map((handler) => { handler(evt); });\n\t\t\t((all.get('*') || []) as WildCardEventHandlerList).slice().map((handler) => { handler(type, evt); });\n\t\t}\n\t};\n}\n"],"sourceRoot":""}